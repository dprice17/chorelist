<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Chorelist</title>
    <link rel="stylesheet" href="/styles/styles.css" />
  </head>

  <body>
    <div class="container">
      <h1>My Chorelist</h1>
      <p class="title-subtext">Get Stuff Done</p>

      <!-- Container for the add chore form -->
      <div class="add-chore-container">
        <form action="/submit" method="POST">
          <input
            type="text"
            class="chore-input-field"
            placeholder="Enter a chore (e.g., Do laundry)"
            name="chore"
            required
          />
          <button type="submit" class="add-btn">Add</button>
        </form>

        <!-- Conditional rendering: checks if there are chores in the data -->
        <% if (Array.isArray(locals.choreData) && locals.choreData.length > 0) {
        %>

        <!-- Container for displaying the list of chores -->
        <div class="chore-list-container">
          <ul class="chore-list">
            <!-- Loop through the list of chores and display each one -->
            <% locals.choreData.forEach(chore => { %>
            <li class="chore">
              <div class="chore-item-container">
                <!-- Display the chore name, associated with its unique ID -->
                <p
                  style="display: block"
                  id="chore-name-<%=chore.id%>"
                  data-id="<%=chore.id%>"
                >
                  <%= Object.values(chore)[1] %>
                </p>

                <!-- Input field for editing the chore, initially hidden -->
                <input
                  type="text"
                  value="<%= Object.values(chore)[1] %>"
                  name="chore"
                  style="display: none"
                  id="edit-chore-input-<%=chore.id%>"
                  class="edit-chore-input"
                  data-id="<%=chore.id%>"
                />

                <!-- Container for edit, save, and delete buttons -->
                <div class="chore-item-btn-container">
                  <!-- Button to trigger edit functionality -->
                  <button
                    type="submit"
                    class="edit-btn"
                    id="edit-btn-<%=chore.id%>"
                    data-id="<%=chore.id%>"
                  >
                    Edit
                  </button>

                  <!-- Form for saving the edited chore -->
                  <form action="/save" method="POST">
                    <!-- Hidden field to store the chore ID -->
                    <input
                      type="hidden"
                      value="<%= Object.values(chore)[0] %>"
                      name="id"
                    />
                    <!-- Hidden input field for submitting the updated/editted chore -->
                    <input
                      type="hidden"
                      name="updatedChore"
                      class="hidden-chore-input"
                      id="hidden-chore-<%=chore.id %>"
                      data-id="<%=chore.id%>"
                    />
                    <!-- Save button, initially hidden, displayed when editing -->
                    <button
                      id="save-btn-<%= chore.id %>"
                      class="save-btn"
                      style="display: none"
                      data-id="<%= chore.id %>"
                    >
                      Save
                    </button>
                  </form>

                  <!-- Form for deleting the chore -->
                  <form action="/delete" method="POST" style="display: inline">
                    <!-- Hidden field to store the chore ID for deletion -->
                    <input
                      type="hidden"
                      value="<%= Object.values(chore)[0] %>"
                      name="id"
                    />
                    <!-- Delete button to remove the chore -->
                    <button type="submit" class="delete-btn">Delete</button>
                  </form>
                </div>
              </div>
            </li>
            <% }) %>
          </ul>
        </div>

        <% } else { %>
        <p class="no-items-para-element">No items on your chore list yet...</p>
        <% } %>
      </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script type="module" src="choreManager.js"></script>
  </body>
</html>
